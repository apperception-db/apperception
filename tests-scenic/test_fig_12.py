from apperception.world import empty_world
from apperception.utils import F
from apperception.predicate import objects, camera
import datetime as datetime


def test_fig_12():
    o = objects[0]
    c = camera
    world = empty_world().filter(
        F.like(o.type, 'human.pedestrian%') &
        F.contained(c.ego, F.road_segment('road')) &
        (F.contained_margin(o.bbox@c.time, F.road_segment('road'), 0.50) | F.contained(o.trans@c.time, F.road_segment('road'))) &
        F.angle_excluding(F.facing_relative(o.traj@c.time, c.ego), -70, 70) &
        F.angle_between(F.facing_relative(c.ego, F.road_direction(c.ego, c.ego)), -15, 15) &
        (F.distance(c.camAbs, o.traj@c.time) < 50) &
        (F.view_angle(o.trans@c.time, c.camAbs) < 35)
    )

    assert set(world.get_id_time_camId_filename(num_joined_tables=1)) == set([('c6e303c0a71b49d99626a80fd0b4e827', datetime.datetime(2018, 5, 21, 8, 11, 11, 412465, tzinfo=datetime.timezone.utc), 'scene-0168', 'samples/CAM_FRONT/n008-2018-05-21-11-06-59-0400__CAM_FRONT__1526915471412465.jpg'), ('371c4fb1a7454570a6bdacdbbcdd7d5c', datetime.datetime(2018, 7, 27, 9, 11, 57, 112404, tzinfo=datetime.timezone.utc), 'scene-0224', 'samples/CAM_FRONT/n008-2018-07-27-12-07-38-0400__CAM_FRONT__1532707917112404.jpg'), ('b24a5fea4d534aa79e9190d96ba62e39', datetime.datetime(2018, 8, 31, 8, 20, 30, 362404, tzinfo=datetime.timezone.utc), 'scene-0284', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535728830362404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 50, 362404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729330362404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 49, 912795, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729329912795.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 49, 412404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729329412404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 48, 912404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729328912404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 48, 412404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729328412404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 47, 912404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729327912404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 47, 412404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729327412404.jpg'), ('1b2ffdc364c0402dad9decd6290fbb47', datetime.datetime(2018, 8, 31, 8, 28, 46, 912404, tzinfo=datetime.timezone.utc), 'scene-0301', 'samples/CAM_FRONT/n008-2018-08-31-11-19-57-0400__CAM_FRONT__1535729326912404.jpg'), ('1fcd6a77d18e4a579e905e29f314e8b7', datetime.datetime(2018, 8, 31, 9, 0, 37, 612404, tzinfo=datetime.timezone.utc), 'scene-0392', 'samples/CAM_FRONT/n008-2018-08-31-11-56-46-0400__CAM_FRONT__1535731237612404.jpg'), ('1fcd6a77d18e4a579e905e29f314e8b7', datetime.datetime(2018, 8, 31, 9, 0, 37, 112404, tzinfo=datetime.timezone.utc), 'scene-0392', 'samples/CAM_FRONT/n008-2018-08-31-11-56-46-0400__CAM_FRONT__1535731237112404.jpg'), ('1fcd6a77d18e4a579e905e29f314e8b7', datetime.datetime(2018, 8, 31, 9, 0, 36, 662404, tzinfo=datetime.timezone.utc), 'scene-0392', 'samples/CAM_FRONT/n008-2018-08-31-11-56-46-0400__CAM_FRONT__1535731236662404.jpg'), ('1fcd6a77d18e4a579e905e29f314e8b7', datetime.datetime(2018, 8, 31, 9, 0, 36, 162404, tzinfo=datetime.timezone.utc), 'scene-0392', 'samples/CAM_FRONT/n008-2018-08-31-11-56-46-0400__CAM_FRONT__1535731236162404.jpg'), ('e8a2ed72b3554c98b18f6b20530a7020', datetime.datetime(2018, 8, 30, 13, 3, 25, 762404, tzinfo=datetime.timezone.utc), 'scene-0541', 'samples/CAM_FRONT/n008-2018-08-30-15-52-26-0400__CAM_FRONT__1535659405762404.jpg'), ('e8a2ed72b3554c98b18f6b20530a7020', datetime.datetime(2018, 8, 30, 13, 3, 25, 262404, tzinfo=datetime.timezone.utc), 'scene-0541', 'samples/CAM_FRONT/n008-2018-08-30-15-52-26-0400__CAM_FRONT__1535659405262404.jpg'), ('e8a2ed72b3554c98b18f6b20530a7020', datetime.datetime(2018, 8, 30, 13, 3, 24, 762404, tzinfo=datetime.timezone.utc), 'scene-0541', 'samples/CAM_FRONT/n008-2018-08-30-15-52-26-0400__CAM_FRONT__1535659404762404.jpg'), ('e8a2ed72b3554c98b18f6b20530a7020', datetime.datetime(2018, 8, 30, 13, 3, 24, 362404, tzinfo=datetime.timezone.utc), 'scene-0541', 'samples/CAM_FRONT/n008-2018-08-30-15-52-26-0400__CAM_FRONT__1535659404362404.jpg'), ('93447c5bd75b4862995b0a4b12b0459f', datetime.datetime(2018, 8, 31, 8, 44, 53, 412404, tzinfo=datetime.timezone.utc), 'scene-0557', 'samples/CAM_FRONT/n008-2018-08-31-11-37-23-0400__CAM_FRONT__1535730293412404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 53, 662404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293293662404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 53, 162404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293293162404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 52, 662404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293292662404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 52, 162404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293292162404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 51, 662404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293291662404.jpg'), ('f98255abcaa4448f8e8293516f45c47a', datetime.datetime(2018, 9, 18, 10, 54, 51, 162404, tzinfo=datetime.timezone.utc), 'scene-0598', 'samples/CAM_FRONT/n008-2018-09-18-13-41-50-0400__CAM_FRONT__1537293291162404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 39, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385159662404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 39, 162404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385159162404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 38, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385158662404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 35, 162404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385155162404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 34, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385154662404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 34, 162404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385154162404.jpg'), ('c24e096fcf4c4e55b74892bddc982eaa', datetime.datetime(2018, 8, 27, 8, 52, 33, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385153662404.jpg'), ('69c08f8de9eb4af1ade1a6f85f9421fd', datetime.datetime(2018, 8, 27, 8, 52, 38, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385158662404.jpg'), ('69c08f8de9eb4af1ade1a6f85f9421fd', datetime.datetime(2018, 8, 27, 8, 52, 35, 162404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385155162404.jpg'), ('69c08f8de9eb4af1ade1a6f85f9421fd', datetime.datetime(2018, 8, 27, 8, 52, 34, 662404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385154662404.jpg'), ('69c08f8de9eb4af1ade1a6f85f9421fd', datetime.datetime(2018, 8, 27, 8, 52, 34, 162404, tzinfo=datetime.timezone.utc), 'scene-0658', 'samples/CAM_FRONT/n008-2018-08-27-11-48-51-0400__CAM_FRONT__1535385154162404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 8, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656808162404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 7, 662404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656807662404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 7, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656807162404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 6, 612404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656806612404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 6, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656806162404.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 5, 662415, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656805662415.jpg'), ('9fff49bd2ddb4719ad65a60d9ae6df63', datetime.datetime(2018, 8, 30, 12, 20, 5, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656805162404.jpg'), ('baae5f7bd0b8432eac525991a9cc9b69', datetime.datetime(2018, 8, 30, 12, 20, 6, 612404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656806612404.jpg'), ('baae5f7bd0b8432eac525991a9cc9b69', datetime.datetime(2018, 8, 30, 12, 20, 6, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656806162404.jpg'), ('baae5f7bd0b8432eac525991a9cc9b69', datetime.datetime(2018, 8, 30, 12, 20, 5, 662415, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656805662415.jpg'), ('baae5f7bd0b8432eac525991a9cc9b69', datetime.datetime(2018, 8, 30, 12, 20, 5, 162404, tzinfo=datetime.timezone.utc), 'scene-0746', 'samples/CAM_FRONT/n008-2018-08-30-15-16-55-0400__CAM_FRONT__1535656805162404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 29, 412404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299149412404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 28, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299148862404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 28, 362404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299148362404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 27, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299147862404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 27, 362404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299147362404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 26, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299146862404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 26, 362404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299146362404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 25, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299145862404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 25, 362404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299145362404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 24, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299144862404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 24, 362404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299144362404.jpg'), ('7244ef2d7394451abfeb57bb33de8adb', datetime.datetime(2018, 9, 18, 12, 32, 23, 862404, tzinfo=datetime.timezone.utc), 'scene-0813', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299143862404.jpg'), ('2fe325de43054797a1b6c92e4bbac3bb', datetime.datetime(2018, 9, 18, 12, 33, 49, 362404, tzinfo=datetime.timezone.utc), 'scene-0816', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299229362404.jpg'), ('fad9ff01047349a595412ba5be48ad41', datetime.datetime(2018, 9, 18, 12, 34, 0, 112404, tzinfo=datetime.timezone.utc), 'scene-0816', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299240112404.jpg'), ('fad9ff01047349a595412ba5be48ad41', datetime.datetime(2018, 9, 18, 12, 33, 59, 112404, tzinfo=datetime.timezone.utc), 'scene-0816', 'samples/CAM_FRONT/n008-2018-09-18-15-26-58-0400__CAM_FRONT__1537299239112404.jpg')]
)